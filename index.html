<!DOCTYPE html>
<html lang="zh-CN">
<head>

 <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
  <title>EPhone PWA</title>
  <link rel="stylesheet" href="style.css"> 
  <link rel="apple-touch-icon" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EPhone">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg">
  <meta name="theme-color" content="#f0f2f5">
    
    <style>
        /* --- ä½ çš„åŸå§‹ CSS --- */
        :root {
            --screen-width: 350px;
            --screen-height: 650px;
            --border-color: #e0e0e0;
            --text-primary: #1f1f1f;
        }

          html {
            -webkit-text-size-adjust: 100%;
            height: 100%; 
        }
        body {
            margin: 0;
            font-family: 'bulangni', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-weight: normal;
            background-color: #f0f2f5;
            height: 100%; 
            overflow: hidden; 
        }

        /* --- æ‰‹æœºå±å¹•å®¹å™¨ --- */
        #phone-screen {
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #6DD5FA, #2980B9);
            background-size: cover;
            background-position: center;
        }

        /* --- çŠ¶æ€æ  CSS å·²åˆ é™¤ --- */

        /* --- å±å¹•é€šç”¨ --- */
        .screen {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s;
        }

        /* --- ä¸»å±å¹•å¸ƒå±€ --- */
        #home-screen {
            /* ä¿®æ”¹ï¼šå»æ‰äº†åŸæœ‰çš„ 44px çŠ¶æ€æ é¢„ç•™é«˜åº¦ï¼Œæ”¹ä¸º 20px åŸºç¡€é—´è· */
            padding-top: calc(20px + env(safe-area-inset-top));
            padding-bottom: 20px;
            box-sizing: border-box;
            z-index: 10;
        }

        #home-screen-pages-container {
            flex-grow: 1;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        #home-screen-pages {
            width: 100%;
            height: 100%;
            display: flex;
        }

        .home-screen-page {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
        }

        #main-content-area {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* --- æ¡Œé¢å›¾æ ‡æ ·å¼ --- */
        #desktop-layout {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 0 20px;
            box-sizing: border-box;
        }

        #desktop-app-container {
            display: flex;
            gap: 30px;
        }

        .desktop-app-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            text-align: center;
            width: 60px;
            -webkit-tap-highlight-color: transparent;
        }

        .icon-bg-desktop {
            width: 60px;
            height: 60px;
            border-radius: 14px;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.1s ease;
        }

        .icon-bg-desktop img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .desktop-app-icon .label {
            color: white;
            font-size: 13px;
            font-weight: 500;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .desktop-app-icon:active .icon-bg-desktop {
            transform: scale(0.9);
            filter: brightness(0.8);
        }

        /* --- App å®¹å™¨æ ·å¼ --- */
        .app-window {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: #fff; 
            z-index: 50; 
            display: none; 
            flex-direction: column;
            padding: 0; /* æ— å†…è¾¹è·ï¼Œå…¨å±æ˜¾ç¤º */
            box-sizing: border-box;
            
            transform: scale(0.9);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .app-window.active {
            display: flex;
            transform: scale(1);
            opacity: 1;
        }

        /* Iframe æ ·å¼ */
        .app-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
            background-color: #fff;
        }

        /* --- æ‚¬æµ®èœå•å®¹å™¨ --- */
/* --- æ‚¬æµ®å®¹å™¨ --- */
#fab-container {
    position: fixed;
    /* åˆå§‹ä½ç½®ä¿æŒä¸å˜ */
    bottom: 100px; 
    right: 20px;
    z-index: 1000;
    
    /* ã€æ ¸å¿ƒä¿®æ”¹ã€‘å›ºå®šå®¹å™¨å¤§å°ä¸ºæŒ‰é’®å¤§å°ï¼Œä¸è¦è¢«èœå•æ’‘å¤§ */
    width: 56px;
    height: 56px;
    
    /* å…è®¸èœå•é£˜å‡ºå®¹å™¨èŒƒå›´ */
    overflow: visible; 
    
    /* ç§»é™¤ flex å¸ƒå±€å¯¹æŒ‰é’®ä½ç½®çš„å½±å“ */
    display: block; 
    transition: transform 0.1s; 
}

/* --- ä¸»æŒ‰é’® --- */
#fab-main {
    width: 56px;
    height: 56px;
    background-color: #333;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    -webkit-tap-highlight-color: transparent;
}

#fab-main svg {
    width: 24px;
    height: 24px;
    fill: white;
    transition: transform 0.3s;
}

/* å±•å¼€æ—¶æ—‹è½¬ä¸»æŒ‰é’® */
#fab-main.expanded {
    transform: rotate(90deg);
    background-color: #444;
}

/* --- èœå•åˆ—è¡¨ (Action Buttons) --- */
.fab-actions {
    /* ã€æ ¸å¿ƒä¿®æ”¹ã€‘ç»å¯¹å®šä½ï¼Œè®©èœå•é£˜åœ¨æŒ‰é’®ä¸Šé¢ï¼Œä¸å ç©ºé—´ */
    position: absolute;
    bottom: 70px; /* è·ç¦»åº•éƒ¨ 56px(æŒ‰é’®é«˜) + 14px(é—´è·) */
    right: 0;     /* å³å¯¹é½ */
    
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 12px;
    
    /* åŠ¨ç”»ä¿æŒä¸å˜ */
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px) scale(0.8);
    transform-origin: bottom right;
    transition: all 0.2s cubic-bezier(0.4, 0.0, 0.2, 1);
    pointer-events: none;
    
    /* é˜²æ­¢æ–‡å­—æ¢è¡Œå½±å“å®½åº¦ */
    width: max-content; 
}

/* èœå•å±•å¼€çŠ¶æ€ */
#fab-container.menu-open .fab-actions {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
    pointer-events: auto;
}

/* å•ä¸ªèœå•é¡¹ */
.fab-action-btn {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.fab-action-btn:active {
    opacity: 0.8;
}

.fab-mini-btn {
    width: 40px;
    height: 40px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 14px;
    font-weight: bold;
}

.fab-label {
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    margin-right: 10px;
    backdrop-filter: blur(4px);
}

/* --- éšèº«æ¨¡å¼ (Ghost Mode) --- */
#fab-container.ghost-mode {
    /* å¼ºåˆ¶å®šä½æ ·å¼ç”± JS æ§åˆ¶ï¼Œè¿™é‡Œæ§åˆ¶å¤–è§‚ */
    opacity: 0.1; /* åŠé€æ˜ */
    transition: opacity 0.3s, right 0.3s, bottom 0.3s;
}

#fab-container.ghost-mode:hover {
    opacity: 0.6; /* ç¨å¾®è§¦æ‘¸æ—¶æ˜¾ä¸€ç‚¹ */
}

/* éšèº«æ¨¡å¼ä¸‹éšè—èœå• */
#fab-container.ghost-mode .fab-actions {
    display: none;
}

/* --- Toast æç¤ºæ¡† --- */
#toast-msg {
    position: fixed;
    bottom: 50px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0,0,0,0.8);
    color: white;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 14px;
    z-index: 2000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s;
    white-space: nowrap;
}

#toast-msg.show {
    opacity: 1;
    visibility: visible;
}
    </style>
</head>
<body>

<div id="phone-screen">
    
    <!-- çŠ¶æ€æ  HTML å·²ç§»é™¤ -->

    <!-- ä¸»å±å¹• (Home Screen) -->
    <div id="home-screen" class="screen">
      <div id="home-screen-pages-container">
        <div id="home-screen-pages">
          <div class="home-screen-page">
            <div id="main-content-area">
              
              <!-- æ¡Œé¢å¸ƒå±€ -->
              <div id="desktop-layout">
                <div id="desktop-app-container">
                  
                  <div class="desktop-app-icon" onclick="openApp('app-a')">
                    <div class="icon-bg-desktop">
                      <img src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg" alt="App A">
                    </div> 
                    <span class="label">330</span>
                  </div>

                  <div class="desktop-app-icon" onclick="openApp('app-b')">
                    <div class="icon-bg-desktop">
                      <img src="https://i.postimg.cc/Kj8JnRcp/267611-CC01-F8-A3-B4910-A2-C2-FFDE479-DC.jpg" alt="App B">
                    </div> 
                    <span class="label">å…”K</span>
                  </div>

                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- App A é¡µé¢ (å…¨å± Iframe) -->
    <div id="app-a" class="app-window app-frame">
    <iframe data-src="https://cx3300-1.github.io/ooooka/" src="" class="app-iframe"></iframe>
</div>

<div id="app-b" class="app-window app-frame">
    <iframe data-src="https://cx3300-1.github.io/-k-/" src="" class="app-iframe"></iframe>
</div>

    <!-- æ‚¬æµ®æŒ‰é’® -->
    <div id="fab-container">
    <div class="fab-actions">
        <div class="fab-action-btn" onclick="openApp('app-a')">
            <span class="fab-label">330</span>
            <div class="fab-mini-btn" style="color: #007bff">330</div>
        </div>

        <div class="fab-action-btn" onclick="openApp('app-b')">
            <span class="fab-label">å…”K</span>
            <div class="fab-mini-btn" style="color: #28a745">å…”K</div>
        </div>

        <div class="fab-action-btn" onclick="hideFab()">
            <span class="fab-label">éšè—æŒ‰é’®</span>
            <div class="fab-mini-btn">ğŸ™ˆ</div>
        </div>

        <div class="fab-action-btn" onclick="goHome()">
            <span class="fab-label">ä¸»é¡µ</span>
            <div class="fab-mini-btn">ğŸ </div>
        </div>
    </div>

    <div id="fab-main">
        </div>
</div>

<div id="toast-msg"></div>
     
</div>

<script>
const fabContainer = document.getElementById('fab-container');
    const fabMain = document.getElementById('fab-main');
    
    // è¿™é‡ŒæŠŠåŸæ¥çš„ id="home-screen" å¯¹åº”ç»™ launcherScreen
    const launcherScreen = document.getElementById('home-screen'); 
    
    // è·å–æ‰€æœ‰çš„ App çª—å£
    const frames = document.querySelectorAll('.app-frame'); 
    const toastMsg = document.getElementById('toast-msg');

    // å›¾æ ‡å®šä¹‰
    const menuIconSvg = '<svg viewBox="0 0 24 24"><path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"/></svg>';
    const closeIconSvg = '<svg viewBox="0 0 24 24"><path d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 1 0-1.41 1.41L10.59 12 5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/></svg>';

    // åˆå§‹åŒ–å›¾æ ‡
    fabMain.innerHTML = menuIconSvg;

    // --- 2. æ ¸å¿ƒåŠŸèƒ½é€»è¾‘ ---

    function openApp(frameId) {
      document.body.classList.add('app-open');
      
      // éšè—ä¸»å±å¹• (æ¨¡æ‹Ÿ)
      launcherScreen.style.opacity = '0';
      launcherScreen.style.transform = 'scale(0.95)';
      
      frames.forEach(frame => {
        if (frame.id === frameId) {
          // æ¿€æ´»å½“å‰ App
          frame.style.display = 'flex';
          setTimeout(() => frame.classList.add('active'), 10);
          
          // æ ¸å¿ƒçœæµé€»è¾‘ï¼šå¦‚æœ src ç©ºæ‰èµ‹å€¼
          const iframe = frame.querySelector('iframe');
          if (iframe && iframe.dataset.src) {
              iframe.src = iframe.dataset.src;
          }
        } else {
          // å…³é—­å…¶ä»– App
          frame.classList.remove('active');
          frame.style.display = 'none';
          const iframe = frame.querySelector('iframe');
          if (iframe) iframe.src = ''; // æ¸…ç†å†…å­˜
        }
      });
      closeMenu();
    }

    function goHome() {
      document.body.classList.remove('app-open');
      
      // æ¢å¤ä¸»å±å¹•
      launcherScreen.style.opacity = '1';
      launcherScreen.style.transform = 'scale(1)';

      // å…³é—­æ‰€æœ‰ App
      setTimeout(() => {
        frames.forEach(frame => {
            frame.classList.remove('active');
            frame.style.display = 'none';
            // æ¸…ç† iframe
            const iframe = frame.querySelector('iframe');
            if (iframe) iframe.src = ''; 
        });
      }, 300);
      closeMenu();
      
      // å›åˆ°ä¸»é¡µæ—¶ï¼Œå¦‚æœå¤„äºéšèº«æ¨¡å¼ï¼Œè‡ªåŠ¨æ¢å¤æ˜¾ç¤ºï¼ˆå¯é€‰ï¼Œå·²æ³¨é‡Šï¼‰
      // showFab(); 
    }

    // --- [æ–°å¢] éšè—åŠŸèƒ½ ---
    function hideFab() {
        closeMenu(); 
        
        // --- æ ¸å¿ƒä¿®æ”¹ ---
        // 1. è·å–ã€é»‘è‰²ä¸»æŒ‰é’®(fab-main)ã€‘åœ¨å±å¹•ä¸Šçš„ä½ç½®
        // æ³¨æ„ï¼šä¸è¦è·å– fabContainer çš„ä½ç½®ï¼Œå› ä¸ºå®ƒåŒ…å«èœå•çš„é«˜åº¦
        const mainRect = fabMain.getBoundingClientRect();
        
        // 2. å°†å®¹å™¨çš„å·¦ä¸Šè§’ï¼Œç›´æ¥é’‰æ­»åœ¨åœ†çƒå½“å‰çš„ä½ç½®
        // è¿™æ ·å½“èœå•æ¶ˆå¤±ï¼ˆdisplay: noneï¼‰åï¼Œåœ†çƒæ­£å¥½å°±åœ¨è¿™ä¸ªåæ ‡ï¼Œä¸ä¼šä½ç§»
        fabContainer.style.left = mainRect.left + 'px';
        fabContainer.style.top = mainRect.top + 'px';
        fabContainer.style.bottom = 'auto'; 
        fabContainer.style.right = 'auto';
        
        // 3. å¼€å¯éšèº«æ¨¡å¼
        // (CSSä¸­ .ghost-mode .fab-actions æ˜¯ display: noneï¼Œæ‰€ä»¥å¿…é¡»ç”¨ä¸Šé¢çš„æ–¹æ³•å®šä½)
        fabContainer.classList.add('ghost-mode');
        
        showToast("å·²éšè—ã€‚ç‚¹å‡»å½“å‰ä½ç½®å¯å‘¼å‡ºã€‚");
    }

    // æ¢å¤æ˜¾ç¤º
    function showFab() {
        fabContainer.classList.remove('ghost-mode');
    }

    function showToast(text) {
        toastMsg.innerText = text;
        toastMsg.classList.add('show');
        setTimeout(() => {
            toastMsg.classList.remove('show');
        }, 3000);
    }

    function toggleMenu() {
      // å¦‚æœå¤„äºéšèº«æ¨¡å¼ï¼Œç‚¹å‡»ä¸»æŒ‰é’®å°±æ˜¯â€œç°èº«â€
      if (fabContainer.classList.contains('ghost-mode')) {
          showFab();
          // ç°èº«çš„åŒæ—¶ç›´æ¥å±•å¼€èœå•ï¼Œä½“éªŒæ›´æµç•…
          setTimeout(() => {
              fabContainer.classList.add('menu-open');
              fabMain.classList.add('expanded');
              fabMain.innerHTML = closeIconSvg;
          }, 50);
          return;
      }

      fabContainer.classList.toggle('menu-open');
      fabMain.classList.toggle('expanded');
      
      if (fabMain.classList.contains('expanded')) {
        fabMain.innerHTML = closeIconSvg;
      } else {
        fabMain.innerHTML = menuIconSvg;
      }
    }

    function closeMenu() {
      fabContainer.classList.remove('menu-open');
      fabMain.classList.remove('expanded');
      fabMain.innerHTML = menuIconSvg;
    }

    document.addEventListener('click', (e) => {
      // åªæœ‰åœ¨èœå•æ‰“å¼€ä¸”ç‚¹å‡»å¤–éƒ¨æ—¶æ‰å…³é—­
      // å¦‚æœæ˜¯éšèº«æ¨¡å¼ç‚¹å‡»äº†ç©ºç™½å¤„ï¼Œä¸éœ€è¦åšä»»ä½•äº‹
      if (!fabContainer.contains(e.target) && fabContainer.classList.contains('menu-open')) {
        closeMenu();
      }
    });

    // --- æ‹–æ‹½åŠŸèƒ½ (ä¿æŒä¸å˜ï¼ŒåŠ äº†éšèº«åˆ¤æ–­) ---
    let isDragging = false;
    let hasMoved = false;
    let startX, startY, initialLeft, initialTop;
    const dragThreshold = 5; 

    fabMain.addEventListener('mousedown', startDrag);
    fabMain.addEventListener('touchstart', startDrag, {passive: false});

    function startDrag(e) {
        // å¦‚æœæ˜¯éšèº«æ¨¡å¼ï¼Œç¦æ­¢æ‹–æ‹½ï¼Œåªå…è®¸ç‚¹å‡»
        if (fabContainer.classList.contains('ghost-mode')) {
            return;
        }

        if (fabContainer.classList.contains('menu-open')) {
            closeMenu();
        }

        isDragging = true;
        hasMoved = false; 

        if (e.type === 'touchstart') {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        } else {
            startX = e.clientX;
            startY = e.clientY;
        }

        const rect = fabContainer.getBoundingClientRect();
        initialLeft = rect.left;
        initialTop = rect.top;

        // å…³é”®ï¼šæ‹–æ‹½å¼€å§‹æ—¶ï¼Œå°†å®šä½åˆ‡æ¢ä¸º left/topï¼Œé˜²æ­¢ CSS bottom/right å¹²æ‰°
        fabContainer.style.bottom = 'auto';
        fabContainer.style.right = 'auto';
        fabContainer.style.left = initialLeft + 'px';
        fabContainer.style.top = initialTop + 'px';

        document.addEventListener('mousemove', onDrag);
        document.addEventListener('touchmove', onDrag, {passive: false});
        document.addEventListener('mouseup', stopDrag);
        document.addEventListener('touchend', stopDrag);
    }

    function onDrag(e) {
        if (!isDragging) return;
        e.preventDefault(); 

        let clientX, clientY;
        if (e.type === 'touchmove') {
            clientX = e.touches[0].clientX;
            clientY = e.touches[0].clientY;
        } else {
            clientX = e.clientX;
            clientY = e.clientY;
        }

        const deltaX = clientX - startX;
        const deltaY = clientY - startY;

        if (Math.abs(deltaX) > dragThreshold || Math.abs(deltaY) > dragThreshold) {
            hasMoved = true;
        }

        fabContainer.style.left = (initialLeft + deltaX) + 'px';
        fabContainer.style.top = (initialTop + deltaY) + 'px';
    }

    function stopDrag() {
        isDragging = false;
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('touchmove', onDrag);
        document.removeEventListener('mouseup', stopDrag);
        document.removeEventListener('touchend', stopDrag);
    }

    fabMain.addEventListener('click', (e) => {
        e.stopPropagation();
        // æ— è®ºæ˜¯æ‹–æ‹½ç»“æŸè¿˜æ˜¯æ™®é€šç‚¹å‡»ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿä½ç§»ï¼Œéƒ½è§†ä¸ºç‚¹å‡»
        if (!hasMoved) {
            toggleMenu();
        }
    });

    // SW æ³¨å†Œ
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js');
        });
    }
</script>
</body>
</html>
